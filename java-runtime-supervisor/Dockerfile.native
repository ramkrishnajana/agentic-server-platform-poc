# GraalVM Native Image Dockerfile for Java Runtime Supervisor
# Build time: 5-10 minutes
# Runtime: Faster startup, lower memory footprint

FROM ghcr.io/graalvm/graalvm-community:17 AS builder
WORKDIR /workspace

# Install native-image
RUN gu install native-image

# Copy source and Maven
COPY . .
RUN chmod +x mvnw

# Build native image
RUN ./mvnw -Pnative package -DskipTests -pl java-runtime-supervisor -am

FROM ubuntu:22.04
WORKDIR /app

# Install Docker CLI for managing worker containers
RUN apt-get update && \
    apt-get install -y docker.io && \
    rm -rf /var/lib/apt/lists/*

# Copy native executable
COPY --from=builder /workspace/java-runtime-supervisor/target/java-runtime-supervisor /app/app

EXPOSE 9091
ENTRYPOINT ["./app"]

